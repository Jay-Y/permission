package com.dream.test;import android.app.AlarmManager;import android.app.PendingIntent;import android.content.Context;import android.content.Intent;import com.dream.test.ui.MainActivity;import org.yapp.core.Application;import org.yapp.utils.Callback;import org.yapp.utils.Log;import org.yapp.utils.Toast;import org.yapp.y;import java.io.File;/** * ClassName: App <br> * Description: 应用核心. <br> * Date: 2015-12-3 下午9:36:50 <br> * Author: ysj */public class App extends Application {    @Override    protected void init() {        y.setDebug(true);        Log.d("App启动");        // 异常处理初始化        y.ex().init(this, new Callback.HandlerCallback<Throwable>() {            @Override            public void onHandle(Throwable ex) {                File log = null;                try {//                    int stackTraceSize = ex.getStackTrace().length;//                    String errorMsg = ex.getLocalizedMessage() + "-&&-";//                    for (int i = 0; i < stackTraceSize; i++) {//                        StackTraceElement stack = ex.getStackTrace()[i];//                        errorMsg += stack.toString() + "\n";//                        if (errorMsg.length() >= 254) {//                            errorMsg += (stackTraceSize - i)//                                    + " more...\n";//                            break;//                        }//                    }//                    log = new File(FileUtil.getCacheDir(AppConsts._LOG),//                            "error.log");//                    IOUtil.writeStr(new FileOutputStream(log), errorMsg);                } catch (Exception e) {                    Log.e(e.getMessage(), e);                } finally {//                    log = null;                    if (y.ex().getStatus() == 0) {                        Intent intent = new Intent(App.this, MainActivity.class);                        PendingIntent restartIntent = PendingIntent                                .getActivity(App.this, 0, intent,                                        Intent.FLAG_ACTIVITY_NEW_TASK);                        AlarmManager mgr = (AlarmManager) App.this                                .getSystemService(Context.ALARM_SERVICE);                        mgr.set(AlarmManager.RTC,                                System.currentTimeMillis() + 3000,                                restartIntent); // 3秒钟后重启应用                    }                    // 杀死线程                    android.os.Process.killProcess(android.os.Process                            .myPid());                }            }        });        if (y.ex().status() != 0) {            Toast.showMessageForCenterShort("有异常退出");        }//        LocationSupports.getInstance().refreshLaction();//        ImageLoader.build(this, HttpFactory.getDefaultDownLoader());//        // Fresco库初始化加载//        Fresco.initialize(this);    }}